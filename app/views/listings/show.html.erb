<h1 class="ui header"><%= @listing.title %></h1>

<% if @listing.active? %>
  <% if @listing.bids.present? %>
    <p>
    <%= pluralize @listing.bids.count, "bid" %> on this item.
    The current price is
    <strong><%= number_to_currency @listing.current_price %></strong>.
    </p>
    <% if current_user == @listing.winning_bid.user %>
      <p>You're the winning bidder! 🎉</p>

      <p>
      Your maximum bid is currently <%= number_to_currency @listing.winning_bid.amount %>.
      FreeBay will automatically bid for you up to this amount.
      </p>
    <% end %>
    </p>
  <% else %>
    <p>
    No bids yet. Feeling lucky? The starting price is
    <strong><%= number_to_currency @listing.starting_price %></strong>.
    </p>
  <% end %>

  <p>
    <%= link_to "Bid now", new_listing_bid_path(@listing), class: "ui primary button" %>
  </p>

<% else %>
  <p>
    Awww, this listing hasn't started, so you can't make a bid yet 🐼
  </p>
<% end %>


<div class="ui grid listing">
  <div class="eight wide column">
    <%= image_tag @listing.image.url(:medium) %>
  </div>

  <div class="eight wide column">
    <h3 class="ui header">Description <%= listing_conditon_tag(@listing) %> <%= listing_category_tag(@listing) %>
      <div class="sub header">
        <%= humanized_end_time(@listing) %>
      </div>
    </h3>

    <p>
      <%= markdown @listing.description %>
    </p>
  </div>

  <div class="sixteen wide column">

  </div>
</div>

<% if @listing.ended? && current_user.admin? && @listing.bids.count > 0 %>
<h2 class="ui header"> Bid History</h2>
<table class="ui celled table">
  <thead>
    <tr><th>Time</th>
    <th>Name</th>
    <th>Email</th>
    <th>Bid</th>
  </tr></thead>
  <tbody>
    <% @listing.bids.order("amount DESC").each do |bid| %>
    <tr>
      <td><%= bid.created_at.to_s :short %></td>
      <td><%= bid.user.name %></td>
      <td><%= bid.user.email %></td>
      <td><%= number_to_currency bid.amount %></td>
    </tr>
    <% end %>
  </tbody>
</table>
<% end %>
